DROP DATABASE IF EXISTS sumavgoverflow;
CREATE DATABASE sumavgoverflow;
USE sumavgoverflow;
DROP TABLE IF EXISTS aggoverflowa;
Warnings:
Note	1051	Unknown table 'sumavgoverflow.aggoverflowa'
DROP TABLE IF EXISTS aggoverflowb;
Warnings:
Note	1051	Unknown table 'sumavgoverflow.aggoverflowb'
DROP TABLE IF EXISTS aggoverflowc;
Warnings:
Note	1051	Unknown table 'sumavgoverflow.aggoverflowc'
DROP TABLE IF EXISTS aggoverflowd;
Warnings:
Note	1051	Unknown table 'sumavgoverflow.aggoverflowd'
CREATE TABLE aggoverflowa
(
id INT,
grp INT,
f1 BIGINT(20) DEFAULT NULL,
f2 BIGINT(20) UNSIGNED DEFAULT NULL,
f3 BIGINT(20) DEFAULT NULL,
f4 BIGINT(20) UNSIGNED DEFAULT NULL,
f5 DOUBLE DEFAULT NULL,
f6 DOUBLE DEFAULT NULL
);
CREATE TABLE aggoverflowb
(
id INT,
grp INT,
f1 BIGINT(20) DEFAULT NULL,
f2 BIGINT(20) UNSIGNED DEFAULT NULL,
f3 BIGINT(20) DEFAULT NULL,
f4 BIGINT(20) UNSIGNED DEFAULT NULL,
f5 DOUBLE DEFAULT NULL,
f6 DOUBLE DEFAULT NULL
);
CREATE TABLE aggoverflowc
(
id INT,
grp INT,
f1 BIGINT(20) DEFAULT NULL,
f2 BIGINT(20) UNSIGNED DEFAULT NULL,
f3 BIGINT(20) DEFAULT NULL,
f4 BIGINT(20) UNSIGNED DEFAULT NULL,
f5 DOUBLE DEFAULT NULL,
f6 DOUBLE DEFAULT NULL
);
CREATE TABLE aggoverflowd
(
id INT,
grp INT,
d1 DECIMAL(6,2) DEFAULT NULL,
d2 DECIMAL(8,4) UNSIGNED DEFAULT NULL,
d3 DECIMAL(18,5) DEFAULT NULL,
d4 DECIMAL(18,3) UNSIGNED DEFAULT NULL
);
insert into aggoverflowa values (1,  100, -78,    1, -7800000000000000000,   100000000000000000, -7800000000000000000,   100000000000000000),
(2,  100, -79,    2, -7900000000000000000,   200000000000000000, -7900000000000000000,   200000000000000000),
(3,  100, -80,    3, -8000000000000000000,   300000000000000000, -8000000000000000000,   300000000000000000),
(4,  100, -81,    4, -8100000000000000000,   400000000000000000, -8100000000000000000,   400000000000000000),
(5,  200, -82,    5, -8200000000000000000,   500000000000000000, -8200000000000000000,   500000000000000000),
(6,  200, -83,    6, -8300000000000000000,   600000000000000000, -8300000000000000000,   600000000000000000),
(7,  200, -84,    7, -8400000000000000000,   700000000000000000, -8400000000000000000,   700000000000000000),
(8,  200, -85,    8, -8500000000000000000,   800000000000000000, -8500000000000000000,   800000000000000000),
(9,  200, -86,    9, -8600000000000000000,   900000000000000000, -8600000000000000000,   900000000000000000),
(10, 300, -87,    1, -8700000000000000000,   100000000000000000, -8700000000000000000,   100000000000000000),
(11, 400, -88,   10, -8800000000000000000,  1000000000000000000, -8800000000000000000,  1000000000000000000),
(12, 400, -89,   11, -8900000000000000000,  1100000000000000000, -8900000000000000000,  1100000000000000000),
(13, 400, -90,   12, -9000000000000000000,  1200000000000000000, -9000000000000000000,  1200000000000000000),
(14, 400, -91,   13, -9100000000000000000,  1300000000000000000, -9100000000000000000,  1300000000000000000),
(15, 400, -92,   12, -9200000000000000000,  1200000000000000000, -9200000000000000000,  1200000000000000000),
(16, 400,  781,  30,  7810000000000000000,  3000000000000000000,  7810000000000000000,  3000000000000000000),
(17, 400,  792,  40,  7920000000000000000,  4000000000000000000,  7920000000000000000,  4000000000000000000),
(18, 400,  804,  50,  8030000000000000000,  5000000000000000000,  8030000000000000000,  5000000000000000000),
(19, 500,  815,  60,  8140000000000000000,  6000000000000000000,  8140000000000000000,  6000000000000000000),
(20, 500,  826,  70,  8250000000000000000,  7000000000000000000,  8250000000000000000,  7000000000000000000),
(21, 500,  837,  80,  8360000000000000000,  8000000000000000000,  8360000000000000000,  8000000000000000000),
(22, 500,  848,  90,  8470000000000000000,  9000000000000000000,  8470000000000000000,  9000000000000000000),
(23, 500,  859, 100,  8580000000000000000, 10000000000000000000,  8580000000000000000, 10000000000000000000),
(24, 500,  861, 110,  8690000000000000000, 11000000000000000000,  8690000000000000000, 11000000000000000000),
(25, 500,  872, 120,  8710000000000000000, 12000000000000000000,  8710000000000000000, 12000000000000000000),
(26, 600,  883, 130,  8820000000000000000, 13000000000000000000,  8820000000000000000, 13000000000000000000),
(27, 600,  894, 140,  8930000000000000000, 14000000000000000000,  8930000000000000000, 14000000000000000000),
(28, 700,  905, 150,  9040000000000000000, 15000000000000000000,  9040000000000000000, 15000000000000000000),
(29, 700,  916, 160,  9150000000000000000, 16000000000000000000,  9150000000000000000, 16000000000000000000),
(30, 800,  927, 170,  9160000000000000000, 17000000000000000000,  9260000000000000000, 17000000000000000000);
insert into aggoverflowb values (1,  100, -78,    1,         -78000000000,         100000000000,         -78000000000,         100000000000),
(2,  100, -79,    2,         -79000000000,         200000000000,         -79000000000,         200000000000),
(3,  100, -80,    3,         -80000000000,         300000000000,         -80000000000,         300000000000),
(4,  100, -81,    4,         -81000000000,         400000000000,         -81000000000,         400000000000),
(5,  200, -82,    5,         -82000000000,         500000000000,         -82000000000,         500000000000),
(6,  200, -83,    6,         -83000000000,         600000000000,         -83000000000,         600000000000),
(7,  200, -84,    7,         -84000000000,         700000000000,         -84000000000,         700000000000),
(8,  200, -85,    8, -8500000000000000000,   800000000000000000, -8500000000000000000,   800000000000000000),
(9,  200, -86,    9, -8600000000000000000,   900000000000000000, -8600000000000000000,   900000000000000000),
(10, 300, -87,    1, -8700000000000000000,   100000000000000000, -8700000000000000000,   100000000000000000),
(11, 400, -88,   10, -8800000000000000000,  1000000000000000000, -8800000000000000000,  1000000000000000000),
(12, 400, -89,   11, -8900000000000000000,  1100000000000000000, -8900000000000000000,  1100000000000000000),
(13, 400, -90,   12, -9000000000000000000,  1200000000000000000, -9000000000000000000,  1200000000000000000),
(14, 400, -91,   13, -9100000000000000000,  1300000000000000000, -9100000000000000000,  1300000000000000000),
(15, 400, -92,   12, -9200000000000000000,  1200000000000000000, -9200000000000000000,  1200000000000000000),
(16, 400,  781,  30,  7800000000000000000,  3000000000000000000,  7800000000000000000,  3000000000000000000),
(17, 400,  792,  40,  7900000000000000000,  4000000000000000000,  7900000000000000000,  4000000000000000000),
(18, 400,  803,  50,  8000000000000000000,  5000000000000000000,  8000000000000000000,  5000000000000000000),
(19, 500,  814,  60,  8100000000000000000,  6000000000000000000,  8100000000000000000,  6000000000000000000),
(20, 500,  825,  70,  8200000000000000000,  7000000000000000000,  8200000000000000000,  7000000000000000000),
(21, 500,  836,  80,  8300000000000000000,  8000000000000000000,  8300000000000000000,  8000000000000000000),
(22, 500,  847,  90,  8400000000000000000,  9000000000000000000,  8400000000000000000,  9000000000000000000),
(23, 500,  858, 100,  8500000000000000000, 10000000000000000000,  8500000000000000000, 10000000000000000000),
(24, 500,  869, 110,  8600000000000000000, 11000000000000000000,  8600000000000000000, 11000000000000000000),
(25, 500,  871, 120,  8700000000000000000, 12000000000000000000,  8700000000000000000, 12000000000000000000),
(26, 600,  882, 130,  8800000000000000000, 13000000000000000000,  8800000000000000000, 13000000000000000000),
(27, 600,  893, 140,  8900000000000000000, 14000000000000000000,  8900000000000000000, 14000000000000000000),
(28, 700,  904, 150,  9000000000000000000, 15000000000000000000,  9000000000000000000, 15000000000000000000),
(29, 700,  915, 160,  9100000000000000000, 16000000000000000000,  9100000000000000000, 16000000000000000000),
(30, 800,  926, 170,  9200000000000000000, 17000000000000000000,  9200000000000000000, 17000000000000000000);
insert into aggoverflowc values (1,  100, -78,   1,  -16000000000000000,    160000000000000000,  -16000000000000000,    160000000000000000),
(2,  100, -79,   2,  -15000000000000000,    150000000000000000,  -15000000000000000,    150000000000000000),
(3,  100, -80,   3,  -14000000000000000,    140000000000000000,  -14000000000000000,    140000000000000000),
(4,  100, -81,   4,  -13000000000000000,    130000000000000000,  -13000000000000000,    130000000000000000),
(5,  200, -82,   5,  -12000000000000000,    120000000000000000,  -12000000000000000,    120000000000000000),
(6,  200, -83,   6,  -11000000000000000,    110000000000000000,  -11000000000000000,    110000000000000000),
(7,  200, -84,   7,  -10000000000000000,    100000000000000000,  -10000000000000000,    100000000000000000),
(8,  200, -85,   8,   -9000000000000000,     90000000000000000,   -9000000000000000,     90000000000000000),
(9,  200, -86,   9,   -8000000000000000,     80000000000000000,   -8000000000000000,     80000000000000000),
(10, 300, -87,   1,   -7000000000000000,     70000000000000000,   -7000000000000000,     70000000000000000),
(11, 400, -88,  10,   -6000000000000000,     60000000000000000,   -6000000000000000,     60000000000000000),
(12, 400, -89,  11,   -5000000000000000,     50000000000000000,   -5000000000000000,     50000000000000000),
(13, 400, -90,  12,   -4000000000000000,     40000000000000000,   -4000000000000000,     40000000000000000),
(14, 400, -91,  13,   -3000000000000000,     30000000000000000,   -3000000000000000,     30000000000000000),
(15, 400, -92,  12,   -2000000000000000,     20000000000000000,   -2000000000000000,     20000000000000000),
(16, 400,  78,  30,   16000000000000000,    160000000000000000,   16000000000000000,    160000000000000000),
(17, 400,  79,  40,   15000000000000000,    150000000000000000,   15000000000000000,    150000000000000000),
(18, 400,  80,  50,   14000000000000000,    140000000000000000,   14000000000000000,    140000000000000000),
(19, 500,  81,  60,   13000000000000000,    130000000000000000,   13000000000000000,    130000000000000000),
(20, 500,  82,  70,   12000000000000000,    120000000000000000,   12000000000000000,    120000000000000000),
(21, 500,  83,  80,   11000000000000000,    110000000000000000,   11000000000000000,    110000000000000000),
(22, 500,  84,  90,   10000000000000000,    100000000000000000,   10000000000000000,    100000000000000000),
(23, 500,  85, 100,    9100000000000000,     90000000000000000,    9100000000000000,     90000000000000000),
(24, 500,  86, 110,    8200000000000000,     80000000000000000,    8200000000000000,     80000000000000000),
(25, 500,  87, 120,    7300000000000000,     70000000000000000,    7300000000000000,     70000000000000000),
(26, 600,  88, 130,    6400000000000000,     60000000000000000,    6400000000000000,     60000000000000000),
(27, 600,  89, 140,    5500000000000000,     50000000000000000,    5500000000000000,     50000000000000000),
(28, 700,  90, 150,    4600000000000000,     40000000000000000,    4600000000000000,     40000000000000000),
(29, 700,  91, 160,    3700000000000000,     30000000000000000,    3700000000000000,     30000000000000000),
(30, 800,  92, 170,    2800000000000000,     20000000000000000,    2800000000000000,     20000000000000000);
insert into aggoverflowd values (1,  100, -78.12,   1.1234,  -16000000000.12345,    160000000000000.123),
(2,  100, -79.12,   2.1234,  -15000000000.12345,    150000000000000.123),
(3,  100, -80.12,   3.1234,  -14000000000.12345,    140000000000000.123),
(4,  100, -81.12,   4.1234,  -13000000000.12345,    130000000000000.123),
(5,  200, -82.12,   5.1234,  -12000000000.12345,    120000000000000.123),
(6,  200, -83.12,   6.1234,  -11000000000.12345,    110000000000000.123),
(7,  200, -84.12,   7.1234,  -10000000000.12345,    100000000000000.123),
(8,  200, -85.12,   8.1234,   -9000000000.12345,     90000000000000.123),
(9,  200, -86.12,   9.1234,   -8000000000.12345,     80000000000000.123),
(10, 300, -87.12,   1.1234,   -7000000000.12345,     70000000000000.123),
(11, 400, -88.12,  10.1234,   -6000000000.12345,     60000000000000.123),
(12, 400, -89.12,  11.1234,   -5000000000.12345,     50000000000000.123),
(13, 400, -90.12,  12.1234,   -4000000000.12345,     40000000000000.123),
(14, 400, -91.12,  13.1234,   -3000000000.12345,     30000000000000.123),
(15, 400, -92.12,  12.1234,   -2000000000.12345,     20000000000000.123),
(16, 400,  78.12,  30.1234,   16000000000.12345,    160000000000000.123),
(17, 400,  79.12,  40.1234,   15000000000.12345,    150000000000000.123),
(18, 400,  80.12,  50.1234,   14000000000.12345,    140000000000000.123),
(19, 500,  81.12,  60.1234,   13000000000.12345,    130000000000000.123),
(20, 500,  82.12,  70.1234,   12000000000.12345,    120000000000000.123),
(21, 500,  83.12,  80.1234,   11000000000.12345,    110000000000000.123),
(22, 500,  84.12,  90.1234,   10000000000.12345,    100000000000000.123),
(23, 500,  85.12, 100.1234,    9100000000.12345,     90000000000000.123),
(24, 500,  86.12, 110.1234,    8200000000.12345,     80000000000000.123),
(25, 500,  87.12, 120.1234,    7300000000.12345,     70000000000000.123),
(26, 600,  88.12, 130.1234,    6400000000.12345,     60000000000000.123),
(27, 600,  89.12, 140.1234,    5500000000.12345,     50000000000000.123),
(28, 700,  90.12, 150.1234,    4600000000.12345,     40000000000000.123),
(29, 700,  91.12, 160.1234,    3700000000.12345,     30000000000000.123),
(30, 800,  92.12, 170.1234,    2800000000.12345,     20000000000000.123);
SELECT grp, SUM(f1), AVG(f2), SUM(f3) sum_f3, AVG(f4), SUM(f5), AVG(f6), count(*) cnt
FROM aggoverflowa
WHERE id > 22
GROUP BY grp
HAVING sum_f3 > 1000
ORDER BY grp;
grp	SUM(f1)	AVG(f2)	sum_f3	AVG(f4)	SUM(f5)	AVG(f6)	cnt
500	2592	110.0000	25980000000000000000	11000000000000000000.0000	2.598e19	1.1e19	3
600	1777	135.0000	17750000000000000000	13500000000000000000.0000	1.775e19	1.35e19	2
700	1821	155.0000	18190000000000000000	15500000000000000000.0000	1.819e19	1.55e19	2
800	927	170.0000	9160000000000000000	17000000000000000000.0000	9.26e18	1.7e19	1
SELECT grp, SUM(f1), AVG(f1), SUM(f3) sum_d3, AVG(f3), count(*) cnt
FROM aggoverflowb
GROUP BY grp
ORDER BY grp;
grp	SUM(f1)	AVG(f1)	sum_d3	AVG(f3)	cnt
100	-318	-79.5000	-318000000000	-79500000000.0000	4
200	-420	-84.0000	-17100000249000000000	-3420000049800000000.0000	5
300	-87	-87.0000	-8700000000000000000	-8700000000000000000.0000	1
400	1926	240.7500	-21300000000000000000	-2662500000000000000.0000	8
500	5920	845.7143	58800000000000000000	8400000000000000000.0000	7
600	1775	887.5000	17700000000000000000	8850000000000000000.0000	2
700	1819	909.5000	18100000000000000000	9050000000000000000.0000	2
800	926	926.0000	9200000000000000000	9200000000000000000.0000	1
SELECT grp, SUM(d1), AVG(d1), SUM(d3) sum_f3, AVG(d3), count(*) cnt
FROM aggoverflowd
GROUP BY grp
ORDER BY grp;
grp	SUM(d1)	AVG(d1)	sum_f3	AVG(d3)	cnt
100	-318.48	-79.620000	-58000000000.49380	-14500000000.123450000	4
200	-420.60	-84.120000	-50000000000.61725	-10000000000.123450000	5
300	-87.12	-87.120000	-7000000000.12345	-7000000000.123450000	1
400	-213.24	-26.655000	24999999999.75310	3124999999.969137500	8
500	588.84	84.120000	70600000000.86415	10085714285.837735714	7
600	177.24	88.620000	11900000000.24690	5950000000.123450000	2
700	181.24	90.620000	8300000000.24690	4150000000.123450000	2
800	92.12	92.120000	2800000000.12345	2800000000.123450000	1
SELECT grp, SUM(f1), AVG(f2), SUM(f3) sum_f3, AVG(f4), SUM(f5), AVG(f6), count(*) cnt
FROM aggoverflowb
GROUP BY grp
ORDER BY grp;
grp	SUM(f1)	AVG(f2)	sum_f3	AVG(f4)	SUM(f5)	AVG(f6)	cnt
100	-318	2.5000	-318000000000	250000000000.0000	-318000000000	250000000000	4
200	-420	7.0000	-17100000249000000000	340000360000000000.0000	-1.7100000249e19	3.4000036e17	5
300	-87	1.0000	-8700000000000000000	100000000000000000.0000	-8.7e18	1e17	1
400	1926	22.2500	-21300000000000000000	2225000000000000000.0000	-2.13e19	2.225e18	8
500	5920	90.0000	58800000000000000000	9000000000000000000.0000	5.88e19	9e18	7
600	1775	135.0000	17700000000000000000	13500000000000000000.0000	1.77e19	1.35e19	2
700	1819	155.0000	18100000000000000000	15500000000000000000.0000	1.81e19	1.55e19	2
800	926	170.0000	9200000000000000000	17000000000000000000.0000	9.2e18	1.7e19	1
SELECT
a.grp, SUM(a.f1), AVG(a.f2), SUM(a.f3), AVG(a.f4), SUM(b.f1), AVG(b.f2), SUM(b.f3), AVG(b.f4)
FROM aggoverflowa a, aggoverflowb b
WHERE a.id = b.id GROUP BY a.grp ORDER BY a.grp;
grp	SUM(a.f1)	AVG(a.f2)	SUM(a.f3)	AVG(a.f4)	SUM(b.f1)	AVG(b.f2)	SUM(b.f3)	AVG(b.f4)
100	-318	2.5000	-31800000000000000000	250000000000000000.0000	-318	2.5000	-318000000000	250000000000.0000
200	-420	7.0000	-42000000000000000000	700000000000000000.0000	-420	7.0000	-17100000249000000000	340000360000000000.0000
300	-87	1.0000	-8700000000000000000	100000000000000000.0000	-87	1.0000	-8700000000000000000	100000000000000000.0000
400	1927	22.2500	-21240000000000000000	2225000000000000000.0000	1926	22.2500	-21300000000000000000	2225000000000000000.0000
500	5918	90.0000	59200000000000000000	9000000000000000000.0000	5920	90.0000	58800000000000000000	9000000000000000000.0000
600	1777	135.0000	17750000000000000000	13500000000000000000.0000	1775	135.0000	17700000000000000000	13500000000000000000.0000
700	1821	155.0000	18190000000000000000	15500000000000000000.0000	1819	155.0000	18100000000000000000	15500000000000000000.0000
800	927	170.0000	9160000000000000000	17000000000000000000.0000	926	170.0000	9200000000000000000	17000000000000000000.0000
SELECT
a.grp, SUM(a.f1*c.f3), SUM(a.f1*c.f5), AVG(a.f2*c.f4), AVG(a.f2*c.f6)
FROM aggoverflowa a, aggoverflowc c
WHERE a.id = c.id GROUP BY a.grp ORDER BY a.grp;
grp	SUM(a.f1*c.f3)	SUM(a.f1*c.f5)	AVG(a.f2*c.f4)	AVG(a.f2*c.f6)
100	4606000000000000000	4.606e18	350000000000000000.0000	3.5e17
200	4190000000000000000	4.19e18	680000000000000000.0000	6.8e17
300	609000000000000000	6.09e17	70000000000000000.0000	7e16
400	-17918232221128654848	3.7422e19	2507500000000000000.0000	2.5075e18
500	22543211852580896768	5.94367e19	8600000000000000000.0000	8.6e18
600	10568200000000000000	1.05682e19	7400000000000000000.0000	7.4e18
700	7552200000000000000	7.5522e18	5400000000000000000.0000	5.4e18
800	2595600000000000000	2.5956e18	3400000000000000000.0000	3.4e18
SELECT AVG(f3) avgb from aggoverflowb
UNION
SELECT SUM(f3) sumc FROM aggoverflowc
ORDER BY avgb;
avgb
3600000000000000.0000
1889999981100000000.0000
SELECT SUM(f3) suma FROM aggoverflowa
UNION
SELECT AVG(f3) avgb from aggoverflowb
UNION
SELECT SUM(f3) sumc FROM aggoverflowc
ORDER BY suma;
suma
3600000000000000.0000
560000000000000000.0000
1889999981100000000.0000
SELECT SUM(suma) sa FROM
( SELECT SUM(f3) suma FROM aggoverflowa
UNION
SELECT AVG(f3) avgb from aggoverflowb
UNION
SELECT SUM(f3) sumc FROM aggoverflowc ) t
ORDER BY sa;
sa
2453599981100000000.0000
SELECT SUM(suma) sa FROM
( SELECT SUM(f3) suma FROM aggoverflowa
UNION
SELECT AVG(avgc) FROM (SELECT AVG(f3) avgc from aggoverflowc) aggb
UNION
SELECT SUM(sumb) FROM (SELECT SUM(f3) AS sumb FROM aggoverflowb) aggc ) t
ORDER BY sa;
sa
57260119433000000000.00000000
SELECT SUM(suma) sa FROM
( SELECT SUM(f5) suma FROM aggoverflowa
UNION
SELECT AVG(avgc) FROM (SELECT AVG(f5) avgc from aggoverflowc) aggb
UNION
SELECT SUM(sumb) FROM (SELECT SUM(f5) AS sumb FROM aggoverflowb) aggc ) t
ORDER BY sa;
sa
5.7360119433e19
SELECT
b.grp,
TRUNCATE(SUM(a.f1 * b.f2), -2) AS VALUE FROM aggoverflowa a, aggoverflowb b, aggoverflowc c
WHERE a.id = b.id AND a.id = c.id AND a.grp < 600 and c.grp > 100 GROUP BY b.grp
HAVING SUM(a.f3 * c.f4) > ( SELECT SUM(f3 * f4 / f6) FROM aggoverflowc WHERE id < 100 )
ORDER BY VALUE DESC;
grp	VALUE
400	92233720368547848100
200	92233720368547755100
300	18446744073709551500
500	535200
SELECT
d.grp,
SUM(a.f1 * d.d2) AS VALUE FROM aggoverflowa a, aggoverflowd d, aggoverflowc c
WHERE a.id = d.id AND a.id = c.id AND a.grp < 600 and c.grp > 100 GROUP BY d.grp
HAVING SUM(d.d3 * d.d4) > ( SELECT SUM(f3 * f4 / f6) FROM aggoverflowc WHERE id < 100 )
ORDER BY VALUE DESC;
grp	VALUE
500	535980.2812
400	90321.7918
select a.f2, c.f4, if (ifnull(SUM(a.f1),0) > 0,1,99) as test1,
if (ifnull(SUM(c.f6),0) > 0 && ifnull(COUNT(*),0) > 0, CONCAT('1:', ROUND(SUM(a.f1) / COUNT(*),1)),'n/a') as 'Ratio Test'
from aggoverflowa a LEFT OUTER JOIN aggoverflowc c using (id) where a.grp=200 group by a.f2,
c.f4 order by 1, 2, 3, 4;
f2	f4	test1	Ratio Test
5	120000000000000000	99	1:-82.0
6	110000000000000000	99	1:-83.0
7	100000000000000000	99	1:-84.0
8	90000000000000000	99	1:-85.0
9	80000000000000000	99	1:-86.0
set columnstore_double_for_decimal_math=1;
select s/d from (select b.f3, sum(a.f3) s, count(distinct a.f5) d from aggoverflowa a join aggoverflowb b on a.id=b.id group by 1) s1 order by 1;
s/d
-9200000000000000000.0000
-9100000000000000000.0000
-9000000000000000000.0000
-8900000000000000000.0000
-8800000000000000000.0000
-8700000000000000000.0000
-8600000000000000000.0000
-8500000000000000000.0000
-8400000000000000000.0000
-8300000000000000000.0000
-8200000000000000000.0000
-8100000000000000000.0000
-8000000000000000000.0000
-7900000000000000000.0000
-7800000000000000000.0000
7810000000000000000.0000
7920000000000000000.0000
8030000000000000000.0000
8140000000000000000.0000
8250000000000000000.0000
8360000000000000000.0000
8470000000000000000.0000
8580000000000000000.0000
8690000000000000000.0000
8710000000000000000.0000
8820000000000000000.0000
8930000000000000000.0000
9040000000000000000.0000
9150000000000000000.0000
9160000000000000000.0000
SELECT SUM(d4) OVER (PARTITION BY grp ORDER BY id RANGE 2 preceding), id, d1, d2 from aggoverflowd where id < 25 order by grp;
SUM(d4) OVER (PARTITION BY grp ORDER BY id RANGE 2 preceding)	id	d1	d2
160000000000000.123	1	-78.12	1.1234
310000000000000.246	2	-79.12	2.1234
420000000000000.369	4	-81.12	4.1234
450000000000000.369	3	-80.12	3.1234
230000000000000.246	6	-83.12	6.1234
300000000000000.369	8	-85.12	8.1234
120000000000000.123	5	-82.12	5.1234
270000000000000.369	9	-86.12	9.1234
330000000000000.369	7	-84.12	7.1234
70000000000000.123	10	-87.12	1.1234
120000000000000.369	14	-91.12	13.1234
60000000000000.123	11	-88.12	10.1234
210000000000000.369	16	78.12	30.1234
450000000000000.369	18	80.12	50.1234
90000000000000.369	15	-92.12	12.1234
150000000000000.369	13	-90.12	12.1234
110000000000000.246	12	-89.12	11.1234
330000000000000.369	17	79.12	40.1234
250000000000000.246	20	82.12	70.1234
130000000000000.123	19	81.12	60.1234
270000000000000.369	24	86.12	110.1234
300000000000000.369	23	85.12	100.1234
360000000000000.369	21	83.12	80.1234
330000000000000.369	22	84.12	90.1234
select grp,
sum(f3) + sum(f4) as res,
rank() over (order by sum(f3) + sum(f4)) as rank
from aggoverflowa
group by grp order by grp;
grp	res	rank
100	-30800000000000000000	2
200	-38500000000000000000	1
300	-8600000000000000000	3
400	-3440000000000000000	4
500	122200000000000000000	8
600	44750000000000000000	6
700	49190000000000000000	7
800	26160000000000000000	5
SELECT avg(daily_cnt),
format(avg(daily_cnt), 0) avg_rows_per_day,
sum(daily_cnt),
format(sum(daily_cnt), 0) total_rows
from (select id, grp, count(*) daily_cnt
from aggoverflowc where grp in (100,300,500) group by 1) a,
aggoverflowa b where a.id = b.id;
avg(daily_cnt)	avg_rows_per_day	sum(daily_cnt)	total_rows
1.0000	1	12	12
DROP DATABASE sumavgoverflow;
